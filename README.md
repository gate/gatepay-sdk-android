# Gate Pay Android SDK Integration Guide

English | [ç®€ä½“ä¸­æ–‡](README.zh-CN.md)

## Overview

The Gate Pay Android SDK enables cryptocurrency payment capabilities within Android applications. It supports multiple payment methods, including Gate Pay, wallet payments, and QR code payments, and provides a complete payment workflow with flexible UI customization options.

## System Requirements

- Android 5.0 (API Level 21) or later
- Kotlin 1.6.0 or later
- Gradle 7.0 or later

## Quick Start

**Prerequisites:** Obtain the Client ID, Scheme, and repos directory (containing the SDK .aar files) from Gate.

ğŸ’¡ **Demo Reference:** For a complete integration example, refer to the GitHub Demo project.

### Step 1: Add Dependencies

#### â‘  Configure Dependency Repositories â€” `settings.gradle.kts`

**Option 1: Reference GitHub Gate Repos Directly**

```kotlin
allprojects {
    repositories {
        mavenCentral()
        maven("https://jitpack.io")
        maven { url = uri("https://raw.githubusercontent.com/gate/gatepay-sdk-android/main/repos") } // GitHub Gate repos
    }
}
```

**Option 2: Use Local Repos**

1ï¼‰Copy the repos folder provided by Gate to the project root directory:

```text
YourProject/
â”œâ”€â”€ repos/              â† SDK repository folder provided by Gate
â”œâ”€â”€ app/
â”œâ”€â”€ settings.gradle.kts
â””â”€â”€ build.gradle.kts
```
2ï¼‰Reference the local repos:
```kotlin
allprojects {
    repositories {
        mavenCentral()
        maven("https://jitpack.io")
        maven { url = uri("${rootProject.projectDir}/repos") }  // Local repos
    }
}
```
> ğŸ’¡ To upgrade the SDK version when using local repos, remove the old version from the `repos` directory and update the dependency version to the latest one.

#### â‘¡ Add Dependency â€” `build.gradle.kts`

```kotlin
dependencies {
    implementation("com.gateio.sdk:gatepay-sdk:VERSION")  // Replace with the actual version in repos
}

android {
    defaultConfig {
        manifestPlaceholders["GATEPAY_SCHEME"] = "YOUR_SCHEME_HERE"  // Scheme provided by Gate
    }
}
```

ğŸ’¡ **Tip:** If you cannot find the provided Scheme, you can call `GatePaySDK.getSchemeByClientId()` and pass in the `clientId` to retrieve it.

### Step 2: Initialize the SDK

Initialize the SDK in `Application.onCreate` (The SDK must be initialized in Application, not in an Activity):

```kotlin
GatePaySDK.init(
    isDebug = true,     // Indicates whether Debug mode is enabled, and must be set to false in production
    applicationContext = this,                // Application context
    clientId = "YOUR_CLIENT_ID",              // Client ID provided by Gate
    appName = "YOUR_APP_NAME",                // App name
    appIcon = "https://your.cdn/icon.png",    // App icon URL
    orderListener = OrderPageListener         // Order page event listener
)
```

ğŸ’¡ Need to customize language, theme, or colors? See the UI Customization section below.

### Step 3: Initiate a Payment (Checkout)

```kotlin
GatePaySDK.openGatePay(
    activity = this,          // Current Activity
    signature = signature,    // Payment signature (generated by server)
    timestamp = timestamp,    // Timestamp (generated by server)
    nonce = nonce,            // Random string, 16â€“32 characters (generated by server)
    prepayId = prepayId,      // Prepay order ID (returned by server)
    packageExt = "GatePay"    // Optional: extension field (default: "GatePay")
)
```

âš ï¸ **Security Compliance:** All signature-related parameters (signature, timestamp, nonce, prepayId) must be generated and issued by the server. The client only forwards these parameters and must not participate in the signature calculation. Reconciliation is based on the server's asynchronous notification.

ğŸ“– **Server Integration:** For details on how to generate signatures and integrate APIs on the server side, please refer to the [Gate Pay Server Documentation](https://www.gate.com/docs/gatepay/common/en/).

## UI Customization

The SDK supports customization of language, theme, and colors.

### Configure During Initialization (Recommended)

```kotlin
GatePaySDK.init(
    isDebug = true,     // Indicates whether Debug mode is enabled, and must be set to false in production
    applicationContext = this,
    clientId = "YOUR_CLIENT_ID",
    appName = "YOUR_APP_NAME",
    appIcon = "https://your.cdn/icon.png",
    languageCode = "en",                         // Optional: language code (defaults to system language)
    payThemeType = PayThemeType.THEME_MODE_DAY,  // Optional: theme (default: AUTO)
    payCustomColor = PaySdkColor(                // Optional: custom colors (default: Gate dark theme)
        // More color configurations...
    ),
    orderListener = OrderPageListener
)
```

### Runtime Configuration

After initialization, you can adjust the settings at any time:

```kotlin
// Set language only
GatePaySDK.applyUiSettings(UiSettings(languageCode = "en"))

// Set theme only
GatePaySDK.applyUiSettings(UiSettings(themeType = PayThemeType.THEME_MODE_NIGHT))

// Set colors only
GatePaySDK.applyUiSettings(UiSettings(customColor = PaySdkColor(
    // More color configurations...
)))

// Apply all settings at once
GatePaySDK.applyUiSettings(
    UiSettings(
        languageCode = "en",
        themeType = PayThemeType.THEME_MODE_DAY,
        customColor = PaySdkColor(
            // More color configurations...
        )
    )
)
```

ğŸ’¡ For detailed configuration options, refer to API Referenceâ€”UI Configuration.

## API Reference

### OrderPageListener

`OrderPageListener` is used to listen for user interaction events on the order page.

**Implementation Example:**

```kotlin
val orderListener = object : OrderPageListener {
    override fun onRequestViewOrder(context: Context, orderInfo: OrderDetailBean) {
        // Triggered when the user clicks "View Order", and the integrator should navigate to the order details page
    }

    override fun onRequestOpenReturnUrl(context: Context, returnUrl: String) {
        // Triggered when the user clicks "Done", and the integrator should open the returnUrl in-app or navigate to a specified page
    }

    override fun onRequestOpenContactSupport(context: Context, url: String) {
        // Triggered when the user clicks "Contact Support", and the integrator should navigate to the customer support page
    }
}
```

**Callback Methods:**

| Method | Trigger | Parameters | Default Behavior (if not implemented) | Recommended Handling |
|--------|---------|------------|--------------------------------------|----------------------|
| `onRequestViewOrder` | User clicks "View Order" | `context`: Context, `orderInfo`: Order details object | No action | Navigate to the merchant app's order details page |
| `onRequestOpenReturnUrl` | User clicks "Done" | `context`: Context, `returnUrl`: Return URL | No action | Navigate within the app or open the specified page |
| `onRequestOpenContactSupport` | User clicks "Contact Support" | `context`: Context, `url`: Support URL | No action | Navigate to the merchant's support page or open the link |

âš ï¸ **Note:**
- All callback methods should be implemented to ensure an optimal user experience.

### UI Configuration

**Supported Language Codes:**

```kotlin
GatePaySDK.applyUiSettings(UiSettings(languageCode = "zh"))
```

| Code | Language | Code | Language |
|------|----------|------|----------|
| `zh` | Simplified Chinese | `ja` | Japanese |
| `tw` | Traditional Chinese | `ko` | Korean |
| `en` | English | `vi` | Vietnamese |
| `in` | Indonesian | `th` | Thai |
| `es` | Spanish | `fr` | French |
| `de` | German | `it` | Italian |
| `pt` | Portuguese | `br` | Portuguese (Brazil) |
| `ru` | Russian | `ar` | Arabic |
| `tr` | Turkish | `uk` | Ukrainian |

**Theme Modes:**

```kotlin
GatePaySDK.applyUiSettings(UiSettings(themeType = PayThemeType.THEME_MODE_NIGHT))
```

- `THEME_MODE_AUTO`â€”Follows system settings (default)
- `THEME_MODE_DAY`â€”Light mode
- `THEME_MODE_NIGHT`â€”Dark mode

**PaySdkColor Configuration:**

```kotlin
GatePaySDK.applyUiSettings(
    UiSettings(
        customColor = PaySdkColor(
            brandColor = R.color.your_brand_color,
            brandTagTextColor = R.color.your_brand_text_color,
            buttonTextColor = R.color.your_button_text_color,
            buttonTextSecondaryColor = R.color.your_button_text_sec,
            buttonBackgroundColor = R.color.your_button_bg,
            buttonBackgroundSecondaryColor = R.color.your_button_bg_sec
        )
    )
)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `brandColor` | `@ColorRes Int` | Brand primary color |
| `brandTagTextColor` | `@ColorRes Int` | Brand tag text color |
| `buttonTextColor` | `@ColorRes Int` | Primary button text color |
| `buttonTextSecondaryColor` | `@ColorRes Int` | Secondary button text color |
| `buttonBackgroundColor` | `@ColorRes Int` | Primary button background color |
| `buttonBackgroundSecondaryColor` | `@ColorRes Int` | Secondary button background color |

**Tip:** Use color resources in the format `R.color.your_color_name`. To support dark mode, configure both `values/colors.xml` and `values-night/colors.xml`.

### Groovy Configuration

If you are using `settings.gradle` with Groovy syntax:

```groovy
allprojects {
    repositories {
        mavenCentral()
        maven { url 'https://jitpack.io' }
        maven { url "${rootProject.projectDir}/repos" }
    }
}
```

## Error Codes & Troubleshooting

### Status Code Reference

| Code | Type | Recommended Action |
|------|------|-------------------|
| 10010 | âœ… Payment completed | Wait for server-side notification to confirm the result |
| 10006 | âŒ User canceled | Display "Payment canceled" |
| 10005 | âŒ Payment failed | Refer to the troubleshooting steps below |
| 10024 | âš ï¸ Invalid parameters | Check SDK initialization parameters |

### Common Issue Troubleshooting

**âŒ Payment Failed (10005)**

Possible Causes and Checks:

1. **Signature Issues:** Ensure that signature, timestamp, nonce, and prepayId are consistent and not expired. Verify the server-side signing algorithm.
2. **Configuration Issues:** Confirm that clientId is correct, baseUrl includes the https:// prefix, and the environment configuration matches.
3. **Network Issues:** Ensure network connectivity, valid SSL certificates, and that no proxy or firewall is intercepting requests.
4. **Advanced Debugging:** Use network inspection tools to capture request parameters. Contact technical support if necessary.

**âš ï¸ Invalid Parameters (10024)**

Resolution Steps:

1. Ensure `GatePaySDK.init` is called in `Application.onCreate`.
2. Confirm that `clientId` has been replaced with a real value (not `YOUR_CLIENT_ID`).
3. Verify that a custom Application is declared in `AndroidManifest.xml`.
4. Check Logcat for SDK initialization logs.

## Integration Checklist

After completing the integration, verify each item below:

- [âœ…] The repos directory is placed in the project root
- [âœ…] Maven repository is configured in `settings.gradle.kts`
- [âœ…] SDK dependency is added in `build.gradle.kts`
- [âœ…] `GATEPAY_SCHEME` is configured with the real value provided by Gate
- [âœ…] `GatePaySDK.init` is called in `Application.onCreate`
- [âœ…] `clientId` has been replaced with a real value (not a placeholder)
- [âœ…] The complete payment flow has been verified
- [âœ…] Server-side asynchronous notification endpoint is configured

## FAQs

**Q1: How can I view Debug logs?**

Set the `isDebug` parameter in `GatePaySDK.init` to `true` to enable Debug mode. Be sure to set it back to `false` for production releases.

**Q2: Is obfuscation configuration required?**

The SDK includes built-in obfuscation rules and requires no additional configuration. If issues occur, you may add the following rule: `-keep class com.gateio.sdk.gatepay.** { *; }`

**Q3: How do I verify that the integration is successful?**

After initialization, check Logcat logs. Initiate a payment and verify that the checkout page is launched. It is recommended to complete the full flow in a Debug environment first.

**Q4: How should the payment result be confirmed?**

The checkout page automatically handles payment results, and no additional code is required for the merchants. Merchants must rely on server-side asynchronous notifications as the final source of truth.

**Q5: Which cryptocurrencies are supported?**

Supported currencies depend on the merchant's configuration. Refer to the Gate Pay Merchant Dashboard for details.

**Q6: What should I do if I see the error "SDK not initialized"?**

Ensure that `GatePaySDK.init` is called in `Application.onCreate` and that initialization occurs before any payment request is made.

## More Version Options

If you have specific requirements, you may choose from the following versions:

| Version                 | Dependency | Init/Entry Class      | Applicable Scenarios                          |
|--------------------|------|-----------------|-------------------------------|
| **Full(Current Version Â· Recommended)** | `gatepay-sdk` | `GatePaySDK`    | Full-featured checkout supporting QR code transfers and wallet payments (including WalletConnect, Phantom, and Bitget Wallet) |
| **Simple**         | `gatepay-sdk-simple` | `GatePaySimple` | Lightweight checkout with smaller package size; supports QR code transfers only, wallet payments are not supported     |
| **Lite**           | `gatepay-sdk-lite` | `GatePayLite`   | Supports redirecting users to the Gate App for payment only           |

**How to switch:**Replace the dependency and the corresponding class name.

**Simple**
```kotlin
implementation("com.gateio.sdk:gatepay-sdk-simple:VERSION")
GatePaySimple.init()  // Parameters are the same as Full
GatePaySimple.openGatePay()  // Parameters are the same as Full
```

**Lite**
```kotlin
implementation("com.gateio.sdk:gatepay-sdk-lite:VERSION")
GatePayLite.init(isDebug, applicationContext, clientId)  // Only 3 parameters are required
GatePayLite.openGatePay()  // Parameters are the same as Full
```

> ğŸ’¡ **Callback handling for Lite:** After payment is completed in the Gate App, the result is returned via Deep Link. You must configure a callback Activity in AndroidManifest.xml:
> ```xml
> <activity android:name=".YourCallbackActivity" android:exported="true">
>     <intent-filter>
>         <action android:name="android.intent.action.VIEW" />
>         <category android:name="android.intent.category.DEFAULT" />
>         <data android:scheme="gatepay******" android:host="payment" />
>     </intent-filter>
> </activity>
> ```
> âš ï¸ `gatepay******` is a Scheme generated by Gate based on the clientId. Please replace it with the actual value.
>
> Parse intent.data to obtain the result parameters: `isSuccess`ï¼ˆ1 = Success / 0 = Failed / 2 = Canceledï¼‰ã€`prepayId`ï¼ˆPrepay order IDï¼‰
>
> Example: `gatepaya1b2c3://payment?isSuccess=1&source=gatePay&prepayId=123435567`

## Technical Support

If you have questions or need assistance, contact us via:

- ğŸ“– GitHub: https://github.com/gate
- ğŸ’¬ Technical Support: Contact your business representative

## Changelog

### v3.0.1 (Current Version)

- âœ¨ Introduced a fully redesigned checkout UI
- ğŸ”„ Added multi-currency, multi-network instant conversion for payments
- ğŸ’° Added Phantom wallet integration
- ğŸŒ Added Bitget wallet support for Solana (SOL) and Tron (TRX) networks

### v2.0.0

- ğŸ“± Full checkout UI support
- âœ¨ Added QR code payment for Gate-initiated payments
- âœ¨ Added Web3 payments (WalletConnect support)
- ğŸ¨ Theme switching support (Light/Dark/System)
- ğŸŒ Multi-language support (18+ languages)
- ğŸ¨ Custom UI color configuration
- ğŸ”§ Improved payment flow and overall user experience

### v1.0.0

- ğŸš€ Initial release
- ğŸ’° Support for Gate-initiated payments
- ğŸ” Server-side signature verification support
