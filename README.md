# Gate Pay Android SDK Integration Guide

## Overview

The Gate Pay Android SDK enables cryptocurrency payment capabilities within Android applications. It supports multiple payment methods, including Gate Pay, wallet payments, and QR code payments, and provides a complete payment workflow with flexible UI customization options.

## System Requirements

- Android 5.0 (API Level 21) or later
- Kotlin 1.6.0 or later
- Gradle 7.0 or later

## Quick Start

**Prerequisites:** Obtain the Client ID, Scheme, and repos directory (containing the SDK .aar files) from Gate.

üí° **Demo Reference:** For a complete integration example, refer to the GitHub Demo project.

### Step 1: Add Dependencies

**‚ë† Place the repos directory to the project root.**

üí° To upgrade the SDK version, remove the old version from repos and update gatepay-sdk:VERSION to the latest version after referencing it.

**‚ë° Configure the Repository:** Edit `settings.gradle.kts`.

**‚ë¢ Add Dependencies:** Edit `build.gradle.kts`.

üí° **Tip:** If you cannot find the provided Scheme, you can call `GatePaySDK.getSchemeByClientId()` and pass in the `clientId` to retrieve it.

### Step 2: Initialize the SDK

Initialize the SDK in `Application.onCreate` (The SDK must be initialized in Application, not in an Activity):

```kotlin
GatePaySDK.init(
    isDebug = true,     // Indicates whether Debug mode is enabled, and must be set to false in production
    applicationContext = this,                // Application context
    clientId = "YOUR_CLIENT_ID",              // Client ID provided by Gate
    appName = "YOUR_APP_NAME",                // App name
    appIcon = "https://your.cdn/icon.png",    // App icon URL
    orderListener = OrderPageListener         // Order page event listener
)
```

üí° Need to customize language, theme, or colors? See the UI Customization section below.

### Step 3: Initiate a Payment (Checkout)

```kotlin
GatePaySDK.openGatePay(
    activity = this,          // Current Activity
    signature = signature,    // Payment signature (generated by server)
    timestamp = timestamp,    // Timestamp (generated by server)
    nonce = nonce,            // Random string, 16‚Äì32 characters (generated by server)
    prepayId = prepayId,      // Prepay order ID (returned by server)
    packageExt = "GatePay"    // Optional: extension field (default: "GatePay")
)
```

‚ö†Ô∏è **Security Compliance:** All signature-related parameters (signature, timestamp, nonce, prepayId) must be generated and issued by the server. The client only forwards these parameters and must not participate in the signature calculation. Reconciliation is based on the server's asynchronous notification.

üìñ **Server Integration:** For details on how to generate signatures and integrate APIs on the server side, please refer to the [Gate Pay Server Documentation](https://www.gate.com/docs/gatepay/common/en/).

## UI Customization

The SDK supports customization of language, theme, and colors.

### Configure During Initialization (Recommended)

```kotlin
GatePaySDK.init(
    isDebug = true,     // Indicates whether Debug mode is enabled, and must be set to false in production
    applicationContext = this,
    clientId = "YOUR_CLIENT_ID",
    appName = "YOUR_APP_NAME",
    appIcon = "https://your.cdn/icon.png",
    languageCode = "en",                         // Optional: language code (defaults to system language)
    payThemeType = PayThemeType.THEME_MODE_DAY,  // Optional: theme (default: AUTO)
    payCustomColor = PaySdkColor(                // Optional: custom colors (default: Gate dark theme)
        // More color configurations...
    ),
    orderListener = OrderPageListener
)
```

### Runtime Configuration

After initialization, you can adjust the settings at any time:

```kotlin
// Set language only
GatePaySDK.applyUiSettings(UiSettings(languageCode = "en"))

// Set theme only
GatePaySDK.applyUiSettings(UiSettings(themeType = PayThemeType.THEME_MODE_NIGHT))

// Set colors only
GatePaySDK.applyUiSettings(UiSettings(customColor = PaySdkColor(
    // More color configurations...
)))

// Apply all settings at once
GatePaySDK.applyUiSettings(
    UiSettings(
        languageCode = "en",
        themeType = PayThemeType.THEME_MODE_DAY,
        customColor = PaySdkColor(
            // More color configurations...
        )
    )
)
```

üí° For detailed configuration options, refer to API Reference‚ÄîUI Configuration.

## API Reference

### OrderPageListener

`OrderPageListener` is used to listen for user interaction events on the order page.

**Implementation Example:**

```kotlin
val orderListener = object : OrderPageListener {
    override fun onRequestViewOrder(context: Context, orderInfo: OrderDetailBean) {
        // Triggered when the user clicks "View Order", and the integrator should navigate to the order details page
    }

    override fun onRequestOpenReturnUrl(context: Context, returnUrl: String) {
        // Triggered when the user clicks "Done", and the integrator should open the returnUrl in-app or navigate to a specified page
    }

    override fun onRequestOpenContactSupport(context: Context, url: String) {
        // Triggered when the user clicks "Contact Support", and the integrator should navigate to the customer support page
    }
}
```

**Callback Methods:**

| Method | Trigger | Parameters | Default Behavior (if not implemented) | Recommended Handling |
|--------|---------|------------|--------------------------------------|----------------------|
| `onRequestViewOrder` | User clicks "View Order" | `context`: Context, `orderInfo`: Order details object | No action | Navigate to the merchant app's order details page |
| `onRequestOpenReturnUrl` | User clicks "Done" | `context`: Context, `returnUrl`: Return URL | No action | Navigate within the app or open the specified page |
| `onRequestOpenContactSupport` | User clicks "Contact Support" | `context`: Context, `url`: Support URL | No action | Navigate to the merchant's support page or open the link |

‚ö†Ô∏è **Note:**
- All callback methods should be implemented to ensure an optimal user experience.

### UI Configuration

**Supported Language Codes:**

| Code | Language | Code | Language |
|------|----------|------|----------|
| `zh` | Simplified Chinese | `ja` | Japanese |
| `tw` | Traditional Chinese | `ko` | Korean |
| `en` | English | `vi` | Vietnamese |
| `in` | Indonesian | `th` | Thai |
| `es` | Spanish | `fr` | French |
| `de` | German | `it` | Italian |
| `pt` | Portuguese | `br` | Portuguese (Brazil) |
| `ru` | Russian | `ar` | Arabic |
| `tr` | Turkish | `uk` | Ukrainian |

**Theme Modes:**

- `THEME_MODE_AUTO`‚ÄîFollows system settings (default)
- `THEME_MODE_DAY`‚ÄîLight mode
- `THEME_MODE_NIGHT`‚ÄîDark mode

**PaySdkColor Configuration:**

| Parameter | Type | Description |
|-----------|------|-------------|
| `brandColor` | `@ColorRes Int` | Brand primary color |
| `brandTagTextColor` | `@ColorRes Int` | Brand tag text color |
| `buttonTextColor` | `@ColorRes Int` | Primary button text color |
| `buttonTextSecondaryColor` | `@ColorRes Int` | Secondary button text color |
| `buttonBackgroundColor` | `@ColorRes Int` | Primary button background color |
| `buttonBackgroundSecondaryColor` | `@ColorRes Int` | Secondary button background color |

**Tip:** Use color resources in the format `R.color.your_color_name`. To support dark mode, configure both `values/colors.xml` and `values-night/colors.xml`.

### Groovy Configuration

If you are using `settings.gradle` with Groovy syntax:

```groovy
allprojects {
    repositories {
        mavenCentral()
        maven { url 'https://jitpack.io' }
        maven { url "${rootProject.projectDir}/repos" }
    }
}
```

## Error Codes & Troubleshooting

### Status Code Reference

| Code | Type | Recommended Action |
|------|------|-------------------|
| 10010 | ‚úÖ Payment completed | Wait for server-side notification to confirm the result |
| 10006 | ‚ùå User canceled | Display "Payment canceled" |
| 10005 | ‚ùå Payment failed | Refer to the troubleshooting steps below |
| 10024 | ‚ö†Ô∏è Invalid parameters | Check SDK initialization parameters |

### Common Issue Troubleshooting

**‚ùå Payment Failed (10005)**

Possible Causes and Checks:

1. **Signature Issues:** Ensure that signature, timestamp, nonce, and prepayId are consistent and not expired. Verify the server-side signing algorithm.
2. **Configuration Issues:** Confirm that clientId is correct, baseUrl includes the https:// prefix, and the environment configuration matches.
3. **Network Issues:** Ensure network connectivity, valid SSL certificates, and that no proxy or firewall is intercepting requests.
4. **Advanced Debugging:** Use network inspection tools to capture request parameters. Contact technical support if necessary.

**‚ö†Ô∏è Invalid Parameters (10024)**

Resolution Steps:

1. Ensure `GatePaySDK.init` is called in `Application.onCreate`.
2. Confirm that `clientId` has been replaced with a real value (not `YOUR_CLIENT_ID`).
3. Verify that a custom Application is declared in `AndroidManifest.xml`.
4. Check Logcat for SDK initialization logs.

## Integration Checklist

After completing the integration, verify each item below:

- [‚úÖ] The repos directory is placed in the project root
- [‚úÖ] Maven repository is configured in `settings.gradle.kts`
- [‚úÖ] SDK dependency is added in `build.gradle.kts`
- [‚úÖ] `GATEPAY_SCHEME` is configured with the real value provided by Gate
- [‚úÖ] `GatePaySDK.init` is called in `Application.onCreate`
- [‚úÖ] `clientId` has been replaced with a real value (not a placeholder)
- [‚úÖ] The complete payment flow has been verified
- [‚úÖ] Server-side asynchronous notification endpoint is configured

## FAQs

**Q1: How can I view Debug logs?**

Set the `isDebug` parameter in `GatePaySDK.init` to `true` to enable Debug mode. Be sure to set it back to `false` for production releases.

**Q2: Is obfuscation configuration required?**

The SDK includes built-in obfuscation rules and requires no additional configuration. If issues occur, you may add the following rule: `-keep class com.gateio.sdk.gatepay.** { *; }`

**Q3: How do I verify that the integration is successful?**

After initialization, check Logcat logs. Initiate a payment and verify that the checkout page is launched. It is recommended to complete the full flow in a Debug environment first.

**Q4: How should the payment result be confirmed?**

The checkout page automatically handles payment results, and no additional code is required for the merchants. Merchants must rely on server-side asynchronous notifications as the final source of truth.

**Q5: Which cryptocurrencies are supported?**

Supported currencies depend on the merchant's configuration. Refer to the Gate Pay Merchant Dashboard for details.

**Q6: What should I do if I see the error "SDK not initialized"?**

Ensure that `GatePaySDK.init` is called in `Application.onCreate` and that initialization occurs before any payment request is made.

## Technical Support

If you have questions or need assistance, contact us via:

- üìñ GitHub: https://github.com/gate
- üí¨ Technical Support: Contact your business representative

## Changelog

### v3.0.0 (Current Version)

- ‚ú® Introduced a fully redesigned checkout UI
- üîÑ Added multi-currency, multi-network instant conversion for payments
- üí∞ Added Phantom wallet integration
- üåê Added Bitget wallet support for Solana (SOL) and Tron (TRX) networks

### v2.0.0

- üì± Full checkout UI support
- ‚ú® Added QR code payment for Gate-initiated payments
- ‚ú® Added Web3 payments (WalletConnect support)
- üé® Theme switching support (Light/Dark/System)
- üåç Multi-language support (18+ languages)
- üé® Custom UI color configuration
- üîß Improved payment flow and overall user experience

### v1.0.0

- üöÄ Initial release
- üí∞ Support for Gate-initiated payments
- üîê Server-side signature verification support
